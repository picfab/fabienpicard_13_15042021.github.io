{"id":"fBJn","dependencies":[{"name":"/Users/fabien/Documents/OpenClassRoom/Projet-13/site/package.json","includedInParent":true,"mtime":1618558896716}],"generated":{"js":"\"use strict\";function e(e,t,o,n,r,a){var s=localStorage.getItem(\"token\");if((e.token||s)&&(e.token||t(a(s)),!e.data)){var c=e.token?e.token:s,i=new Headers;i.append(\"Authorization\",\"Bearer \".concat(c)),i.append(\"Cookie\",\"cxssh_status=off\"),fetch(\"http://localhost:3001/api/v1/user/profile\",{method:\"POST\",headers:i,redirect:\"follow\"}).then(function(e){return e.json()}).then(function(e){200===e.status?t(n(e.body)):t(r())}).catch(function(e){t(r())})}e.token||localStorage.getItem(\"token\")||(t(r()),o.push(\"/signin\"))}Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.verifUser=e;"},"sourceMaps":{"js":{"mappings":[{"source":"../src/controllers/verifuser.js","original":{"line":59,"column":1},"generated":{"line":1,"column":0}},{"source":"../src/controllers/verifuser.js","original":{"line":16,"column":7},"generated":{"line":1,"column":13}},{"source":"../src/controllers/verifuser.js","name":"verifUser","original":{"line":16,"column":16},"generated":{"line":1,"column":22}},{"source":"../src/controllers/verifuser.js","name":"user","original":{"line":17,"column":2},"generated":{"line":1,"column":24}},{"source":"../src/controllers/verifuser.js","name":"dispatch","original":{"line":18,"column":2},"generated":{"line":1,"column":26}},{"source":"../src/controllers/verifuser.js","name":"history","original":{"line":19,"column":2},"generated":{"line":1,"column":28}},{"source":"../src/controllers/verifuser.js","name":"updateDataUserAction","original":{"line":20,"column":2},"generated":{"line":1,"column":30}},{"source":"../src/controllers/verifuser.js","name":"logoutUserAction","original":{"line":21,"column":2},"generated":{"line":1,"column":32}},{"source":"../src/controllers/verifuser.js","name":"logUserAction","original":{"line":22,"column":2},"generated":{"line":1,"column":34}},{"source":"../src/controllers/verifuser.js","name":"tokenLocal","original":{"line":24,"column":8},"generated":{"line":1,"column":37}},{"source":"../src/controllers/verifuser.js","name":"tokenLocal","original":{"line":24,"column":8},"generated":{"line":1,"column":41}},{"source":"../src/controllers/verifuser.js","name":"localStorage","original":{"line":24,"column":21},"generated":{"line":1,"column":43}},{"source":"../src/controllers/verifuser.js","name":"getItem","original":{"line":24,"column":34},"generated":{"line":1,"column":56}},{"source":"../src/controllers/verifuser.js","original":{"line":24,"column":42},"generated":{"line":1,"column":64}},{"source":"../src/controllers/verifuser.js","name":"user","original":{"line":25,"column":6},"generated":{"line":1,"column":73}},{"source":"../src/controllers/verifuser.js","name":"user","original":{"line":25,"column":6},"generated":{"line":1,"column":77}},{"source":"../src/controllers/verifuser.js","name":"token","original":{"line":25,"column":11},"generated":{"line":1,"column":79}},{"source":"../src/controllers/verifuser.js","name":"tokenLocal","original":{"line":25,"column":20},"generated":{"line":1,"column":86}},{"source":"../src/controllers/verifuser.js","name":"user","original":{"line":26,"column":9},"generated":{"line":1,"column":91}},{"source":"../src/controllers/verifuser.js","name":"token","original":{"line":26,"column":14},"generated":{"line":1,"column":93}},{"source":"../src/controllers/verifuser.js","name":"dispatch","original":{"line":27,"column":6},"generated":{"line":1,"column":100}},{"source":"../src/controllers/verifuser.js","name":"logUserAction","original":{"line":27,"column":15},"generated":{"line":1,"column":102}},{"source":"../src/controllers/verifuser.js","name":"tokenLocal","original":{"line":27,"column":29},"generated":{"line":1,"column":104}},{"source":"../src/controllers/verifuser.js","name":"user","original":{"line":29,"column":9},"generated":{"line":1,"column":109}},{"source":"../src/controllers/verifuser.js","name":"data","original":{"line":29,"column":14},"generated":{"line":1,"column":111}},{"source":"../src/controllers/verifuser.js","original":{"line":29,"column":20},"generated":{"line":1,"column":117}},{"source":"../src/controllers/verifuser.js","name":"id","original":{"line":30,"column":12},"generated":{"line":1,"column":118}},{"source":"../src/controllers/verifuser.js","name":"id","original":{"line":30,"column":12},"generated":{"line":1,"column":122}},{"source":"../src/controllers/verifuser.js","name":"user","original":{"line":30,"column":17},"generated":{"line":1,"column":124}},{"source":"../src/controllers/verifuser.js","name":"token","original":{"line":30,"column":22},"generated":{"line":1,"column":126}},{"source":"../src/controllers/verifuser.js","name":"user","original":{"line":30,"column":30},"generated":{"line":1,"column":132}},{"source":"../src/controllers/verifuser.js","name":"token","original":{"line":30,"column":35},"generated":{"line":1,"column":134}},{"source":"../src/controllers/verifuser.js","name":"tokenLocal","original":{"line":30,"column":43},"generated":{"line":1,"column":140}},{"source":"../src/controllers/verifuser.js","name":"myHeaders","original":{"line":31,"column":12},"generated":{"line":1,"column":142}},{"source":"../src/controllers/verifuser.js","original":{"line":31,"column":24},"generated":{"line":1,"column":144}},{"source":"../src/controllers/verifuser.js","name":"Headers","original":{"line":31,"column":28},"generated":{"line":1,"column":148}},{"source":"../src/controllers/verifuser.js","name":"myHeaders","original":{"line":32,"column":6},"generated":{"line":1,"column":156}},{"source":"../src/controllers/verifuser.js","name":"append","original":{"line":32,"column":16},"generated":{"line":1,"column":158}},{"source":"../src/controllers/verifuser.js","original":{"line":32,"column":23},"generated":{"line":1,"column":165}},{"source":"../src/controllers/verifuser.js","name":"id","original":{"line":32,"column":50},"generated":{"line":1,"column":181}},{"source":"../src/controllers/verifuser.js","name":"id","original":{"line":32,"column":50},"generated":{"line":1,"column":191}},{"source":"../src/controllers/verifuser.js","name":"id","original":{"line":32,"column":50},"generated":{"line":1,"column":198}},{"source":"../src/controllers/verifuser.js","name":"myHeaders","original":{"line":33,"column":6},"generated":{"line":1,"column":202}},{"source":"../src/controllers/verifuser.js","name":"append","original":{"line":33,"column":16},"generated":{"line":1,"column":204}},{"source":"../src/controllers/verifuser.js","original":{"line":33,"column":23},"generated":{"line":1,"column":211}},{"source":"../src/controllers/verifuser.js","original":{"line":33,"column":33},"generated":{"line":1,"column":220}},{"source":"../src/controllers/verifuser.js","name":"fetch","original":{"line":40,"column":6},"generated":{"line":1,"column":240}},{"source":"../src/controllers/verifuser.js","original":{"line":40,"column":12},"generated":{"line":1,"column":246}},{"source":"../src/controllers/verifuser.js","original":{"line":35,"column":29},"generated":{"line":1,"column":290}},{"source":"../src/controllers/verifuser.js","name":"method","original":{"line":36,"column":8},"generated":{"line":1,"column":291}},{"source":"../src/controllers/verifuser.js","original":{"line":36,"column":16},"generated":{"line":1,"column":298}},{"source":"../src/controllers/verifuser.js","name":"headers","original":{"line":37,"column":8},"generated":{"line":1,"column":305}},{"source":"../src/controllers/verifuser.js","name":"myHeaders","original":{"line":37,"column":17},"generated":{"line":1,"column":313}},{"source":"../src/controllers/verifuser.js","name":"redirect","original":{"line":38,"column":8},"generated":{"line":1,"column":315}},{"source":"../src/controllers/verifuser.js","original":{"line":38,"column":18},"generated":{"line":1,"column":324}},{"source":"../src/controllers/verifuser.js","name":"then","original":{"line":41,"column":9},"generated":{"line":1,"column":335}},{"source":"../src/controllers/verifuser.js","original":{"line":41,"column":14},"generated":{"line":1,"column":340}},{"source":"../src/controllers/verifuser.js","name":"response","original":{"line":41,"column":15},"generated":{"line":1,"column":349}},{"source":"../src/controllers/verifuser.js","name":"response","original":{"line":41,"column":28},"generated":{"line":1,"column":352}},{"source":"../src/controllers/verifuser.js","name":"response","original":{"line":41,"column":28},"generated":{"line":1,"column":359}},{"source":"../src/controllers/verifuser.js","name":"json","original":{"line":41,"column":37},"generated":{"line":1,"column":361}},{"source":"../src/controllers/verifuser.js","name":"then","original":{"line":42,"column":9},"generated":{"line":1,"column":370}},{"source":"../src/controllers/verifuser.js","original":{"line":42,"column":14},"generated":{"line":1,"column":375}},{"source":"../src/controllers/verifuser.js","name":"result","original":{"line":42,"column":15},"generated":{"line":1,"column":384}},{"source":"../src/controllers/verifuser.js","original":{"line":43,"column":32},"generated":{"line":1,"column":387}},{"source":"../src/controllers/verifuser.js","name":"result","original":{"line":43,"column":14},"generated":{"line":1,"column":393}},{"source":"../src/controllers/verifuser.js","name":"status","original":{"line":43,"column":21},"generated":{"line":1,"column":395}},{"source":"../src/controllers/verifuser.js","name":"dispatch","original":{"line":44,"column":12},"generated":{"line":1,"column":402}},{"source":"../src/controllers/verifuser.js","name":"updateDataUserAction","original":{"line":44,"column":21},"generated":{"line":1,"column":404}},{"source":"../src/controllers/verifuser.js","name":"result","original":{"line":44,"column":42},"generated":{"line":1,"column":406}},{"source":"../src/controllers/verifuser.js","name":"body","original":{"line":44,"column":49},"generated":{"line":1,"column":408}},{"source":"../src/controllers/verifuser.js","name":"dispatch","original":{"line":46,"column":12},"generated":{"line":1,"column":415}},{"source":"../src/controllers/verifuser.js","name":"logoutUserAction","original":{"line":46,"column":21},"generated":{"line":1,"column":417}},{"source":"../src/controllers/verifuser.js","name":"catch","original":{"line":50,"column":9},"generated":{"line":1,"column":424}},{"source":"../src/controllers/verifuser.js","original":{"line":50,"column":15},"generated":{"line":1,"column":430}},{"source":"../src/controllers/verifuser.js","name":"error","original":{"line":50,"column":16},"generated":{"line":1,"column":439}},{"source":"../src/controllers/verifuser.js","name":"dispatch","original":{"line":51,"column":10},"generated":{"line":1,"column":442}},{"source":"../src/controllers/verifuser.js","name":"logoutUserAction","original":{"line":51,"column":19},"generated":{"line":1,"column":444}},{"source":"../src/controllers/verifuser.js","name":"user","original":{"line":55,"column":7},"generated":{"line":1,"column":451}},{"source":"../src/controllers/verifuser.js","name":"token","original":{"line":55,"column":12},"generated":{"line":1,"column":453}},{"source":"../src/controllers/verifuser.js","name":"localStorage","original":{"line":55,"column":22},"generated":{"line":1,"column":460}},{"source":"../src/controllers/verifuser.js","name":"getItem","original":{"line":55,"column":35},"generated":{"line":1,"column":473}},{"source":"../src/controllers/verifuser.js","original":{"line":55,"column":43},"generated":{"line":1,"column":481}},{"source":"../src/controllers/verifuser.js","name":"dispatch","original":{"line":56,"column":4},"generated":{"line":1,"column":492}},{"source":"../src/controllers/verifuser.js","name":"logoutUserAction","original":{"line":56,"column":13},"generated":{"line":1,"column":494}},{"source":"../src/controllers/verifuser.js","name":"history","original":{"line":57,"column":4},"generated":{"line":1,"column":499}},{"source":"../src/controllers/verifuser.js","name":"push","original":{"line":57,"column":12},"generated":{"line":1,"column":501}},{"source":"../src/controllers/verifuser.js","original":{"line":57,"column":17},"generated":{"line":1,"column":506}},{"source":"../src/controllers/verifuser.js","original":{"line":59,"column":1},"generated":{"line":1,"column":518}},{"source":"../src/controllers/verifuser.js","original":{"line":59,"column":1},"generated":{"line":1,"column":525}},{"source":"../src/controllers/verifuser.js","original":{"line":59,"column":1},"generated":{"line":1,"column":540}},{"source":"../src/controllers/verifuser.js","original":{"line":59,"column":1},"generated":{"line":1,"column":548}},{"source":"../src/controllers/verifuser.js","original":{"line":59,"column":1},"generated":{"line":1,"column":561}},{"source":"../src/controllers/verifuser.js","original":{"line":59,"column":1},"generated":{"line":1,"column":562}},{"source":"../src/controllers/verifuser.js","original":{"line":59,"column":1},"generated":{"line":1,"column":569}},{"source":"../src/controllers/verifuser.js","original":{"line":59,"column":1},"generated":{"line":1,"column":573}},{"source":"../src/controllers/verifuser.js","original":{"line":59,"column":1},"generated":{"line":1,"column":581}},{"source":"../src/controllers/verifuser.js","original":{"line":59,"column":1},"generated":{"line":1,"column":591}}],"sources":{"../src/controllers/verifuser.js":"/* eslint-disable import/prefer-default-export */\n\n/**\n * Verify if user are connected a token in local storage is valid.<br/>\n * And redirect if the user can't acces to an user page\n * @function verifUser\n * @prop {object} user From user's store\n * @prop {function} dispatch Function for connected to redux's dispatch\n * @prop {object} history Object from react-router for redirect user\n * @prop {function} updateDataUserAction Action for update user and set user's store\n * @prop {function} logoutUserAction Action for logout user and set user's store\n * @prop {function} logUserAction Action for login user and set user's store\n * @return  {null}\n */\n\nexport function verifUser(\n  user,\n  dispatch,\n  history,\n  updateDataUserAction,\n  logoutUserAction,\n  logUserAction\n) {\n  const tokenLocal = localStorage.getItem('token')\n  if (user.token || tokenLocal) {\n    if (!user.token) {\n      dispatch(logUserAction(tokenLocal))\n    }\n    if (!user.data) {\n      const id = user.token ? user.token : tokenLocal\n      const myHeaders = new Headers()\n      myHeaders.append('Authorization', `Bearer ${id}`)\n      myHeaders.append('Cookie', 'cxssh_status=off')\n\n      const requestOptions = {\n        method: 'POST',\n        headers: myHeaders,\n        redirect: 'follow',\n      }\n      fetch('http://localhost:3001/api/v1/user/profile', requestOptions)\n        .then((response) => response.json())\n        .then((result) => {\n          if (result.status === 200) {\n            dispatch(updateDataUserAction(result.body))\n          } else {\n            dispatch(logoutUserAction())\n          }\n        })\n        // eslint-disable-next-line no-unused-vars\n        .catch((error) => {\n          dispatch(logoutUserAction())\n        })\n    }\n  }\n  if (!user.token && !localStorage.getItem('token')) {\n    dispatch(logoutUserAction())\n    history.push('/signin')\n  }\n}\n"},"lineCount":null}},"error":null,"hash":"93a4dd5d5f1609d511336934639c108b","cacheData":{"env":{}}}